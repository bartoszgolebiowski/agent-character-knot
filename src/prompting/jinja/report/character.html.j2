<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ character.canonical_name }} - Character Profile</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>{{ character.canonical_name }}</h1>
        <p class="importance-score">{{ character.importance_score | importance_stars }}</p>
    </header>

    <nav>
        <a href="index.html">← Back to Index</a>
    </nav>

    <main>
        <section>
            <h2>Profile</h2>
            <p><strong>Also Known As:</strong> <span class="aliases">
                {{ character.aliases | join(", ") if character.aliases else "No known aliases" }}
            </span></p>
            <p><strong>First Appearance:</strong> {{ character.first_appearance_chapter | chapter_link | safe }}</p>
            <p><strong>Description:</strong> {{ character.description or "No description available." }}</p>
        </section>

        <section>
            <h2>Relationships</h2>
            {% if relationships %}
                {% for other_id, history in relationships.items() %}
                <div class="relationship-history">
                    <h3>Relationship with {{ other_id | character_link | safe }}</h3>
                    <p class="current-status"><strong>Current Status:</strong> {{ history.latest_relation_type }}</p>

                    {% for interaction in history.interactions %}
                    <div class="interaction">
                        <p class="interaction-type">{{ interaction.relation_type }}</p>
                        <p><strong>Context:</strong> {{ interaction.context }}</p>
                        <p><strong>Reasoning:</strong> {{ interaction.reasoning }}</p>
                        <div class="quote">
                            "{{ interaction.evidence.quote }}"
                            <p class="attribution">
                                — {{ interaction.evidence.chapter_index | chapter_link(interaction.evidence.chapter_title) | safe }}
                            </p>
                        </div>

                        {% if interaction.references_event_id and interaction.references_event_id in events_by_id %}
                        {% set event = events_by_id[interaction.references_event_id] %}
                        <div class="event-card significance-{{ event.significance }}">
                            <p><strong>Long-term Connection:</strong> {{ event.description }}</p>
                            <p><strong>Past Event:</strong> {{ event.chapter_index | chapter_link(event.chapter_title) | safe }}</p>
                            <div class="quote">"{{ event.evidence_quote }}"</div>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}
            {% else %}
                <p>No relationships recorded.</p>
            {% endif %}
        </section>
    </main>

    <footer>
        <p>Generated by StoryGraph AI Agent</p>
    </footer>
</body>
</html>
