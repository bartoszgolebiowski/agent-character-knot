<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ chapter.title }} - Chapter Analysis</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>{{ chapter.title }}</h1>
        <p class="subtitle">Chapter {{ chapter.index + 1 }}</p>
    </header>

    <nav>
        <a href="index.html">← Back to Index</a>
        {% if chapter.index > 0 %}
        <a href="chapter-{{ "%03d" | format(chapter.index - 1) }}.html">← Previous Chapter</a>
        {% endif %}
        {% if chapter.index + 1 < total_chapters %}
        <a href="chapter-{{ "%03d" | format(chapter.index + 1) }}.html">Next Chapter →</a>
        {% endif %}
    </nav>

    <main>
        <section>
            <h2>Summary</h2>
            <p>{{ chapter.summary or "No summary available." }}</p>
        </section>

        <section>
            <h2>Significant Events ({{ events | length }})</h2>
            {% if events %}
                {% for event in events %}
                <div class="event-card significance-{{ event.significance }}">
                    <p><strong>Significance:</strong> {{ event.significance | upper }}</p>
                    <p>{{ event.description }}</p>
                    <p><strong>Involved:</strong>
                        {% if event.involved_characters %}
                            {% for char_id in event.involved_characters %}
                                {{ char_id | character_link | safe }}{% if not loop.last %}, {% endif %}
                            {% endfor %}
                        {% else %}
                            Unknown
                        {% endif %}
                    </p>
                    <div class="quote">"{{ event.evidence_quote }}"</div>
                </div>
                {% endfor %}
            {% else %}
                <p>No significant events recorded.</p>
            {% endif %}
        </section>

        <section>
            <h2>Relationship Changes ({{ relationships | length }})</h2>
            {% if relationships %}
                {% for interaction in relationships %}
                <div class="interaction {% if interaction.is_causal_node %}causal-node{% endif %}" id="interaction-{{ interaction.interaction_id }}">
                    <p class="interaction-type">{{ interaction.relation_type }}</p>
                    <p>
                        {{ interaction.character_a_id | character_link | safe }}
                        ↔
                        {{ interaction.character_b_id | character_link | safe }}
                    </p>
                    <p>{{ interaction.context }}</p>
                    {% if interaction.causal_reasoning %}
                    <p><strong>Causal Reasoning:</strong> {{ interaction.causal_reasoning }}</p>
                    {% endif %}
                    <div class="quote">"{{ interaction.evidence.quote }}"</div>
                    {% if interaction.resolves_interaction_id %}
                    <p class="causal-link">
                        <strong>Reason:</strong>
                        {{ interaction.resolves_interaction_id | interaction_link("View causal origin") | safe }}
                    </p>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <p>No new relationships in this chapter.</p>
            {% endif %}
        </section>
    </main>

    <footer>
        <p>Generated by StoryGraph AI Agent</p>
    </footer>
</body>
</html>
